<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="1015px" preserveAspectRatio="none" style="width:1816px;height:1015px;background:#FFFFFF;" version="1.1" viewBox="0 0 1816 1015" width="1816px" zoomAndPan="magnify"><defs/><g><path d="M19.5,7 L1248.0388,7 A12.5,12.5 0 0 1 1260.5388,19.5 L1260.5388,33.2969 L7,33.2969 L7,19.5 A12.5,12.5 0 0 1 19.5,7" fill="#F1F1F1"/><rect fill="none" height="1002.6897" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="1253.5388" x="7" y="7"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="1260.5388" y1="33.2969" y2="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.3301" x="574.6043" y="24.9951">Upgrade running</text><g class="entity" data-qualified-name="x.n1" data-source-line="27" id="ent0003"><path d="M985.57,44.2969 L985.57,99.6953 L1251.5388,99.6953 L1251.5388,54.2969 L1241.5388,44.2969 L985.57,44.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1241.5388,44.2969 L1241.5388,54.2969 L1251.5388,54.2969 L1241.5388,44.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.5942" x="991.57" y="61.3638">Blue - all data dirs on old version.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.5327" x="991.57" y="76.4966">Green - all data dirs on new version.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.9688" x="991.57" y="91.6294">Yellow - potential mix of old and new.</text></g><g><rect fill="#ADD8E6" height="78.2031" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="162.9277" x="876.09" y="213.6969"/><line style="stroke:#181818;stroke-width:0.5;" x1="876.09" x2="1039.0177" y1="239.9937" y2="239.9937"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.6465" x="930.2306" y="231.692">Prepare</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121.916" x="881.09" y="256.1324">prepare new pgdata</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142.9277" x="881.09" y="270.1012">run pg_upgrade --check</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114.6855" x="881.09" y="284.0699">run prepare scripts</text></g><g><rect fill="#ADD8E6" height="64.2344" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134.9258" x="844.09" y="856.3169"/><line style="stroke:#181818;stroke-width:0.5;" x1="844.09" x2="979.0158" y1="882.6138" y2="882.6138"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.9893" x="854.5583" y="874.312">RollbackPrepare</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114.9258" x="849.09" y="898.7524">run rollback scripts</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.5" x="849.09" y="912.7212">delete new pgdata</text></g><ellipse cx="911.55" cy="986.1169" fill="none" rx="11" ry="11" style="stroke:#FF0000;stroke-width:1;"/><ellipse cx="911.55" cy="986.1169" fill="#FF0000" rx="6" ry="6" style="stroke:#FF0000;stroke-width:1;"/><g><rect fill="#F5DEB3" height="120.1094" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="250.5781" x="653.26" y="328.8969"/><line style="stroke:#181818;stroke-width:0.5;" x1="653.26" x2="903.8381" y1="355.1938" y2="355.1938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.8555" x="748.6213" y="346.892">Upgrade</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="25.916" x="658.26" y="371.3324">stop</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="196.2949" x="658.26" y="385.3012">wait for replication + checkpoint</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="230.5781" x="658.26" y="399.2699">prepare replica upgrade (start rsyncd)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="71.3613" x="658.26" y="413.2387">pg_upgrade</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84.3867" x="658.26" y="427.2074">switch pgdata</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="229.5469" x="658.26" y="441.1762">run postupgrade (update version info)</text></g><g><rect fill="#F5DEB3" height="78.2031" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="235.4844" x="248.81" y="502.0069"/><line style="stroke:#181818;stroke-width:0.5;" x1="248.81" x2="484.2944" y1="528.3038" y2="528.3038"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.4326" x="307.3359" y="520.002">UpgradeReplicas</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="196.5117" x="253.81" y="544.4424">send upgrade API call to replicas</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="215.4844" x="253.81" y="558.4112">wait for replicas to confirm upgrade</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69.8379" x="253.81" y="572.3799">stop rsyncd</text></g><g><rect fill="#98FB98" height="120.1094" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="225.2598" x="185.92" y="683.2069"/><line style="stroke:#181818;stroke-width:0.5;" x1="185.92" x2="411.1798" y1="709.5038" y2="709.5038"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.6465" x="253.7266" y="701.202">PostUpgrade</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83.8652" x="190.92" y="725.6424">start postgres</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121.6055" x="190.92" y="739.6112">start analyze thread</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97.0488" x="190.92" y="753.5799">wait_replicas up</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115.6816" x="190.92" y="767.5487">cleanup old pgdata</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="205.2598" x="190.92" y="781.5174">reanalyze non-default stats target</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147.3223" x="190.92" y="795.4862">run post upgrade scripts</text></g><g><rect fill="#F5DEB3" height="64.2344" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="198.957" x="533.07" y="508.9869"/><line style="stroke:#181818;stroke-width:0.5;" x1="533.07" x2="732.027" y1="535.2838" y2="535.2838"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3457" x="573.8757" y="526.982">CleanupUpgrade</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109.377" x="538.07" y="551.4224">Check local status</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178.957" x="538.07" y="565.3912">Ask other members for status</text></g><g class="entity" data-qualified-name="x.resume" id="ent0011"><polygon fill="#F1F1F1" points="632.55,731.2669,644.55,743.2669,632.55,755.2669,620.55,743.2669,632.55,731.2669" style="stroke:#181818;stroke-width:0.5;"/></g><ellipse cx="957.55" cy="71.9969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#ADD8E6" height="40" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="73.7998" x="920.65" y="136.6969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.7998" x="925.65" y="161.5436">Precheck</text><ellipse cx="298.55" cy="888.4369" fill="none" rx="11" ry="11" style="stroke:#008000;stroke-width:1;"/><ellipse cx="298.55" cy="888.4369" fill="#008000" rx="6" ry="6" style="stroke:#008000;stroke-width:1;"/><g class="entity" data-qualified-name="x.GMN2" data-source-line="45" id="ent0003"><path d="M940.59,973.5569 L940.59,982.1169 L922.61,986.1169 L940.59,990.1169 L940.59,998.6897 A0,0 0 0 0 940.59,998.6897 L1000.5075,998.6897 A0,0 0 0 0 1000.5075,998.6897 L1000.5075,983.5569 L990.5075,973.5569 L940.59,973.5569 A0,0 0 0 0 940.59,973.5569" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M990.5075,973.5569 L990.5075,983.5569 L1000.5075,983.5569 L990.5075,973.5569" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38.9175" x="946.59" y="990.6238">Failed</text></g><g class="entity" data-qualified-name="x.GMN5" data-source-line="57" id="ent0006"><path d="M404.24,368.8169 L404.24,409.0825 A0,0 0 0 0 404.24,409.0825 L634.8587,409.0825 A0,0 0 0 0 634.8587,409.0825 L634.8587,392.9569 L652.78,388.9569 L634.8587,384.9569 L634.8587,378.8169 L624.8587,368.8169 L404.24,368.8169 A0,0 0 0 0 404.24,368.8169" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M624.8587,368.8169 L624.8587,378.8169 L634.8587,378.8169 L624.8587,368.8169" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.6187" x="410.24" y="385.8838">Primary data dir state unknown.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.6626" x="410.24" y="401.0166">Replicas are old version.</text></g><g class="entity" data-qualified-name="x.GMN8" data-source-line="63" id="ent0009"><path d="M595.32,217.5269 L595.32,288.0581 A0,0 0 0 0 595.32,288.0581 L735.94,288.0581 L755.52,328.5369 L743.94,288.0581 L857.7721,288.0581 A0,0 0 0 0 857.7721,288.0581 L857.7721,227.5269 L847.7721,217.5269 L595.32,217.5269 A0,0 0 0 0 595.32,217.5269" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M847.7721,217.5269 L847.7721,227.5269 L857.7721,227.5269 L847.7721,217.5269" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233.9365" x="601.32" y="234.5938">Upgrade error should try to cleanup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.8047" x="601.32" y="249.7266">and start old version. Crash needs to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.4521" x="601.32" y="264.8594">determine state from disk. On failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.1958" x="601.32" y="279.9922">release lock.</text></g><g class="entity" data-qualified-name="x.GMN11" data-source-line="76" id="ent0012"><path d="M18,520.9769 L18,561.2425 A0,0 0 0 0 18,561.2425 L231.0991,561.2425 A0,0 0 0 0 231.0991,561.2425 L231.0991,545.1069 L248.53,541.1069 L231.0991,537.1069 L231.0991,530.9769 L221.0991,520.9769 L18,520.9769 A0,0 0 0 0 18,520.9769" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M221.0991,520.9769 L221.0991,530.9769 L231.0991,530.9769 L221.0991,520.9769" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.0991" x="24" y="538.0438">Primary data dir new version.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.8872" x="24" y="553.1766">Replica data dir state broken</text></g><!--link *start*x to Precheck--><g class="link" data-entity-1="ent0002" data-entity-2="ent0003" data-link-type="dependency" data-source-line="33" id="lnk4"><path d="M957.55,82.4869 C957.55,95.5469 957.55,113.3869 957.55,130.3069" fill="none" id="*start*x-to-Precheck" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="957.55,136.3069,961.55,127.3069,957.55,131.3069,953.55,127.3069,957.55,136.3069" style="stroke:#181818;stroke-width:1;"/></g><!--link Precheck to Prepare--><g class="link" data-entity-1="ent0003" data-entity-2="ent0004" data-link-type="dependency" data-source-line="34" id="lnk5"><path d="M957.55,177.1969 C957.55,187.6369 957.55,194.8769 957.55,207.2969" fill="none" id="Precheck-to-Prepare" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="957.55,213.2969,961.55,204.2969,957.55,208.2969,953.55,204.2969,957.55,213.2969" style="stroke:#181818;stroke-width:1;"/></g><!--link Prepare to RollbackPrepare--><g class="link" data-entity-1="ent0004" data-entity-2="ent0005" data-link-type="dependency" data-source-line="39" id="lnk6"><path d="M957.55,292.2569 C957.55,319.0769 957.55,355.6969 957.55,387.9569 C957.55,387.9569 957.55,387.9569 957.55,744.2669 C957.55,784.2069 943.6513,822.107 930.4313,850.517" fill="none" id="Prepare-to-RollbackPrepare" style="stroke:#FF0000;stroke-width:1;"/><polygon fill="#FF0000" points="927.9,855.9569,935.3236,849.4846,930.0094,851.4236,928.0704,846.1095,927.9,855.9569" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.9102" x="958.55" y="545.6738">[fail]</text></g><!--link RollbackPrepare to RollbackPrepare--><g class="link" data-entity-1="ent0005" data-entity-2="ent0005" data-link-type="dependency" data-source-line="42" id="lnk7"><path d="M979.25,878.3669 C989.81,879.8669 997.01,883.2269 997.01,888.4369 C997.01,893.6469 995.7504,896.1631 985.1904,897.6631" fill="none" id="RollbackPrepare-to-RollbackPrepare" style="stroke:#FF0000;stroke-width:1;"/><polygon fill="#FF0000" points="979.25,898.5069,988.7231,901.2014,984.2003,897.8037,987.598,893.2809,979.25,898.5069" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.9102" x="1003.01" y="893.0038">[fail]</text></g><!--link RollbackPrepare to failed--><g class="link" data-entity-1="ent0005" data-entity-2="ent0006" data-link-type="dependency" data-source-line="46" id="lnk8"><path d="M911.55,921.0369 C911.55,939.7569 911.55,956.2469 911.55,968.9969" fill="none" id="RollbackPrepare-to-failed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="911.55,974.9969,915.55,965.9969,911.55,969.9969,907.55,965.9969,911.55,974.9969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.9946" x="912.55" y="951.6238">[success]</text></g><!--link Prepare to Upgrade--><g class="link" data-entity-1="ent0004" data-entity-2="ent0007" data-link-type="dependency" data-source-line="48" id="lnk9"><path d="M906.26,292.2369 C891.17,303.5469 879.1125,312.5902 862.7025,324.8802" fill="none" id="Prepare-to-Upgrade" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="857.9,328.4769,867.5015,326.2834,861.902,325.4796,862.7059,319.8802,857.9,328.4769" style="stroke:#181818;stroke-width:1;"/></g><!--link Upgrade to RollbackPrepare--><g class="link" data-entity-1="ent0007" data-entity-2="ent0005" data-link-type="dependency" data-source-line="61" id="lnk10"><path d="M855.28,449.3969 C870.19,464.8369 883.86,482.6369 892.55,502.0069 C906.84,533.8669 910.4009,763.4972 911.2509,849.8472" fill="none" id="Upgrade-to-RollbackPrepare" style="stroke:#FF0000;stroke-width:1;"/><polygon fill="#FF0000" points="911.31,855.8469,915.2212,846.8079,911.2608,850.8471,907.2216,846.8867,911.31,855.8469" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.9102" x="907.55" y="636.2738">[fail]</text></g><!--link Upgrade to UpgradeReplicas--><g class="link" data-entity-1="ent0007" data-entity-2="ent0008" data-link-type="dependency" data-source-line="70" id="lnk11"><path d="M652.96,445.3569 C649.8,446.5969 646.66,447.8169 643.55,449.0069 C592.01,468.7069 539.8546,486.3183 490.3846,502.1483" fill="none" id="Upgrade-to-UpgradeReplicas" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="484.67,503.9769,494.4609,505.0437,489.4321,502.453,492.0228,497.4243,484.67,503.9769" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.9946" x="592.55" y="480.0738">[success]</text></g><!--link UpgradeReplicas to PostUpgrade--><g class="link" data-entity-1="ent0008" data-entity-2="ent0009" data-link-type="dependency" data-source-line="80" id="lnk12"><path d="M365.62,580.6269 C363.97,605.4569 359.8,638.0669 349.55,665.2069 C347.28,671.2169 347.2998,671.9308 344.1798,677.7908" fill="none" id="UpgradeReplicas-to-PostUpgrade" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="341.36,683.0869,349.1204,677.0225,343.7098,678.6734,342.0589,673.2628,341.36,683.0869" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.9946" x="365.55" y="636.2738">[success]</text></g><!--link UpgradeReplicas to PostUpgrade--><g class="link" data-entity-1="ent0008" data-entity-2="ent0009" data-link-type="dependency" data-source-line="81" id="lnk13"><path d="M248.39,575.2069 C239.54,581.5769 231.69,589.1669 225.55,598.2069 C208.83,622.8569 214.53,637.5469 225.55,665.2069 C228.01,671.3769 227.9289,672.3035 231.6389,677.9835" fill="none" id="UpgradeReplicas-to-PostUpgrade-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="234.92,683.0069,233.3472,673.2844,232.1857,678.8207,226.6494,677.6592,234.92,683.0069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.8042" x="257.5253" y="611.2738">[timeout]</text><path d="M230.55,620.3397 L230.55,660.3397 L344.55,660.3397 L344.55,630.3397 L334.55,620.3397 L230.55,620.3397" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M334.55,620.3397 L334.55,630.3397 L344.55,630.3397 L334.55,620.3397" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.7549" x="236.55" y="637.4066">Failed replicas</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6548" x="236.55" y="652.5394">need reinit.</text></g><!--link PostUpgrade to PostUpgrade--><g class="link" data-entity-1="ent0009" data-entity-2="ent0009" data-link-type="dependency" data-source-line="95" id="lnk14"><path d="M411.42,730.1469 C422.29,732.8069 429.18,737.1769 429.18,743.2669 C429.18,749.3469 428.118,752.3007 417.248,754.9607" fill="none" id="PostUpgrade-to-PostUpgrade" style="stroke:#FF0000;stroke-width:1;"/><polygon fill="#FF0000" points="411.42,756.3869,421.1128,758.133,416.2767,755.1984,419.2113,750.3622,411.42,756.3869" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.9102" x="435.18" y="747.8338">[fail]</text></g><!--link UpgradeReplicas to CleanupUpgrade--><g class="link" data-entity-1="ent0008" data-entity-2="ent0010" data-link-type="dependency" data-source-line="97" id="lnk15"><path d="M484.77,541.1069 C500.87,541.1069 511.25,541.1069 526.97,541.1069" fill="none" id="UpgradeReplicas-to-CleanupUpgrade" style="stroke:#FF0000;stroke-width:1;"/><polygon fill="#FF0000" points="532.97,541.1069,523.97,537.1069,527.97,541.1069,523.97,545.1069,532.97,541.1069" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.9102" x="494.18" y="534.1738">[fail]</text></g><!--link CleanupUpgrade to CleanupUpgrade--><g class="link" data-entity-1="ent0010" data-entity-2="ent0010" data-link-type="dependency" data-source-line="101" id="lnk16"><path d="M732.39,530.8369 C743.13,532.8169 750.03,536.2369 750.03,541.1069 C750.03,545.9769 749.0306,548.3091 738.2906,550.2891" fill="none" id="CleanupUpgrade-to-CleanupUpgrade" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="732.39,551.3769,741.9661,553.6789,737.3071,550.4704,740.5156,545.8114,732.39,551.3769" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9478" x="756.03" y="545.6738">[rsync interrupted]</text></g><!--link resume to UpgradeReplicas--><g class="link" data-entity-1="ent0011" data-entity-2="ent0008" data-link-type="dependency" data-source-line="105" id="lnk17"><path d="M624,739.3769 C599.82,730.9169 529.64,704.2869 482.55,665.2069 C453.54,641.1369 456.4,625.6469 430.55,598.2069 C424.98,592.2969 423.2635,590.3915 417.0635,584.6815" fill="none" id="resume-to-UpgradeReplicas" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="412.65,580.6169,416.5604,589.6562,416.3279,584.0041,421.98,583.7715,412.65,580.6169" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.0918" x="483.55" y="636.2738">[new data &amp; promote]</text></g><!--link CleanupUpgrade to resume--><g class="link" data-entity-1="ent0010" data-entity-2="ent0011" data-link-type="dependency" data-source-line="107" id="lnk18"><path d="M632.55,573.3869 C632.55,618.6869 632.55,694.4369 632.55,724.6369" fill="none" id="CleanupUpgrade-to-resume" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="632.55,730.6369,636.55,721.6369,632.55,725.6369,628.55,721.6369,632.55,730.6369" style="stroke:#181818;stroke-width:1;"/></g><!--link resume to RollbackPrepare--><g class="link" data-entity-1="ent0011" data-entity-2="ent0005" data-link-type="dependency" data-source-line="108" id="lnk19"><path d="M638.36,749.7369 C655.45,765.5869 707.6,812.0569 758.55,838.3169 C785.21,852.0569 810.7008,861.2443 837.9808,869.2143" fill="none" id="resume-to-RollbackPrepare" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="843.74,870.8969,836.2229,864.5335,838.9406,869.4947,833.9794,872.2125,843.74,870.8969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.0396" x="759.55" y="834.3838">[old data &amp; promote]</text></g><!--link PostUpgrade to *end*x--><g class="link" data-entity-1="ent0009" data-entity-2="ent0020" data-link-type="dependency" data-source-line="110" id="lnk21"><path d="M298.55,803.7369 C298.55,831.3969 298.55,855.5369 298.55,870.9969" fill="none" id="PostUpgrade-to-*end*x" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="298.55,876.9969,302.55,867.9969,298.55,871.9969,294.55,867.9969,298.55,876.9969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.9946" x="299.55" y="834.3838">[success]</text></g><g class="entity" data-qualified-name="upgrade" data-source-line="113" id="ent0012"><rect fill="#DDA0DD" height="243.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="440.1689" x="1369.77" y="386.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58.4814" x="1560.6138" y="401.8451">upgrade</text><line style="stroke:#181818;stroke-width:1;" x1="1475.1313" x2="1475.1313" y1="407.1469" y2="630.4125"/><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="407.1469" y2="407.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.4209" x="1374.77" y="422.142">initiator</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.6924" x="1480.1313" y="422.142">postgres0</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="427.4438" y2="427.4438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.9912" x="1374.77" y="442.4389">old_sysid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.3506" x="1480.1313" y="442.4389">...</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="447.7406" y2="447.7406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.6182" x="1374.77" y="462.7357">old_version</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17.8145" x="1480.1313" y="462.7357">16</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="468.0375" y2="468.0375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.3613" x="1374.77" y="483.0326">shutdown_lsn</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.165" x="1480.1313" y="483.0326">123456789</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="488.3344" y2="488.3344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.5859" x="1374.77" y="503.3295">new_sysid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.3506" x="1480.1313" y="503.3295">...</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="508.6313" y2="508.6313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2129" x="1374.77" y="523.6264">new_version</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17.8145" x="1480.1313" y="523.6264">18</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="528.9281" y2="528.9281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.4648" x="1374.77" y="543.9232">state</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.8555" x="1480.1313" y="543.9232">Upgrade</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="549.225" y2="549.225"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.8408" x="1374.77" y="564.2201">config</text><line style="stroke:#181818;stroke-width:1;" x1="1658.9897" x2="1658.9897" y1="549.225" y2="610.1156"/><line style="stroke:#181818;stroke-width:1;" x1="1475.1313" x2="1809.9389" y1="549.225" y2="549.225"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173.8584" x="1480.1313" y="564.2201">replica_upgrade_method</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.9053" x="1663.9897" y="564.2201">rsync</text><line style="stroke:#181818;stroke-width:1;" x1="1475.1313" x2="1809.9389" y1="569.5219" y2="569.5219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.9053" x="1480.1313" y="584.517">rsync</text><line style="stroke:#181818;stroke-width:1;" x1="1724.5864" x2="1724.5864" y1="569.5219" y2="610.1156"/><line style="stroke:#181818;stroke-width:1;" x1="1658.9897" x2="1809.9389" y1="569.5219" y2="569.5219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28.6973" x="1663.9897" y="584.517">port</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.6289" x="1729.5864" y="584.517">5432</text><line style="stroke:#181818;stroke-width:1;" x1="1658.9897" x2="1809.9389" y1="589.8188" y2="589.8188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.5967" x="1663.9897" y="604.8139">conf_dir</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.3525" x="1729.5864" y="604.8139">/tmp/rsync</text><line style="stroke:#181818;stroke-width:1;" x1="1369.77" x2="1809.9389" y1="610.1156" y2="610.1156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0518" x="1374.77" y="625.1107">progress</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.3506" x="1480.1313" y="625.1107">...</text></g><!--reverse link x to upgrade--><g class="link" data-entity-1="ent0002" data-entity-2="ent0012" data-link-type="dependency" data-source-line="131" id="lnk23"><path d="M1266.77,508.35 C1301.96,508.35 1329.96,508.35 1361.88,508.35" fill="none" id="x-backto-upgrade" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1260.77,508.35,1269.77,512.35,1265.77,508.35,1269.77,504.35,1260.77,508.35" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.5586" x="1278.65" y="501.4169">etcd state</text></g><!--SRC=[bLRVZzis37xtNq7aW67TBhbTVwtBWW3j0Ilsj4E1FXI78D1PIgn5bWn9NfeD-Tz7Ih9YEzw0ljp5v4UAulUHzihvanBhOc4KXtyA0EUP5xVXxmV3Jy46y86LXu_Mj9e_66KiABcl_BDgnQ_eFXVdebZKykit93XMWlbBi1R7RmXkc19xAuJE2LPtwHv59Ra0KJV-15ouqih6IwEB8kI4sUTcRnaYRAkrrFiPC0TKTw4Dkl51tySZyMum1wOKSEOPS6aT60tKfh-4TPXp4O0VgOuf95rfWFmYb397X3PubFQIAQ2UcLr8oZIda4KXw0SYYg9u-c43y_aQ7gqeAr4UOBL2w7fTP4FoDioAlZCyBw59lwYKPa_LzPpO0JHkszIG-Jna70FIKsoaAx9x_dHZ1T-iuPDHwXdv6LMnXASTasfJZFqnhqtMdFWQneKIVb3x69Dgc5yNaKzFjDE3u5WRDdUz1WgBX5lICL4G4KluBVo_FWeFIKamjslBKZYtwRK3_PsqLYka5NdedfUeQjFq7ezCUjYXZZ5OoPAHGE572FrlZDI-X-q8I53ewFeUBsOzM7VI9N_H3yYKzWiuIbzMNHylza2nSJvdRHjE_Kgw1QbtvaMQ3ILseLCfEaZwqSgQsLCMVfnVQFL1csEI_QTOkGEwnc1yBahlAlfFLML2GodOpd4bNGPXBJRMLQR5apoMvWsKIZ3TDW57OnPRroy57Ynp5MfDS8SH0SbHVRQMMgHBxQofyOxki80_T113Q-FP5fNA77R8b8V1_EPhNTIHkv5KqbVJ68AyKRAEdFUFlqD9QmQlbEJW9cB6wdAX1KRlfArX98t-KTJKAATfmZliDF5Nsox1nz9ujkOWz3NrkPAmqL2Ibsd2r3Yp_zUeKGX2lQo5QNtI2ofPINq8TSK1lpIGRCGxMgIMli_VC6TK3KqBldhSf9Dffav_epuhAnWVGOYNRUO4vJXq9v46MNQxUW30b2czDdhEnOwroeUk8iFCxeKV1wJXpWBAItm0p3CtQc5Qe5Uzxk0FiU3Hrik18_SI7i8B2sS4ttjKTUkkCU_T0OolX8LQrCyefo3aX1x3IIbN6Pw2X75nuV3Qjl5OQlSIGDRQcWejAoDBWHkwIAQf-QHS9EgWt-zm3viQHR6Ph2AcwR85qyG28sQliWsOm3XwvT_4Ruh1Y-PS_EbGnXsLDurgw_HrD2FTIkQDdIrXrWdqfzbjzEAnMtToafDtiLZqxMbYoNF_jdEuglKSr_TMEVBSltpr-itRdz_zajpObCbyPE_dUvVpKVV9bExPsSDEsgCZNYFOqdnqhx1jBNnbmac1rnGQeS7GZmxcnbYFrZUlNxsy7Nhel2rk8ifsv-lcBcR8e7FuTKxL8KNKHjVTahuoly9gdYbOWl0bZsljNm00]--></g></svg>